# 科系名額管理功能說明

## 功能概述

本功能為續招報名系統新增了科系名額管理機制，讓管理員可以：
- 設定各科系的招生名額
- 即時查看各科系的報名狀況
- 管理科系資料（新增、編輯、刪除）

## 檔案結構

### 新增檔案
1. `create_department_quota_table.sql` - 資料表建立腳本
2. `setup_department_quotas.php` - 資料表設定頁面
3. `department_quota_api.php` - 科系名額管理 API
4. `department_quota_management.php` - 科系名額管理頁面

### 修改檔案
1. `continued_admission_list.php` - 新增科系名額顯示和管理連結

## 使用步驟

### 1. 建立資料表
1. 登入後台管理系統
2. 前往「續招報名管理」→「科系名額設定」
3. 點擊「建立科系名額資料表」按鈕
4. 系統會自動建立所需的資料表和預設資料

### 2. 管理科系名額
1. 在續招報名列表頁面，點擊「管理名額」按鈕
2. 或直接前往「科系名額管理」頁面
3. 可以進行以下操作：
   - 查看各科系的名額使用狀況
   - 編輯科系招生名額
   - 新增科系
   - 刪除科系（需確認無錄取學生）

### 3. 查看報名狀況
在續招報名列表頁面，可以看到：
- 各科系的名額使用情況（總名額、已錄取、剩餘名額）
- 學生的志願選擇（第一志願會特別標示）
- 即時的名額統計

## 資料表結構

### department_quotas（科系名額表）
- `id` - 主鍵
- `department_name` - 科系名稱
- `department_code` - 科系代碼
- `total_quota` - 總名額
- `current_enrolled` - 目前已錄取人數（動態計算）
- `is_active` - 是否啟用
- `description` - 科系描述

### continued_admission_choices（志願選擇表）
- `id` - 主鍵
- `application_id` - 續招報名ID
- `department_code` - 科系代碼
- `choice_order` - 志願順序

## 預設科系

系統會自動建立以下預設科系：
- 資訊科（IT）- 30名
- 電子科（EE）- 25名
- 機械科（ME）- 20名
- 商管科（BM）- 35名
- 餐飲科（CF）- 40名
- 美容科（BC）- 30名
- 幼保科（EC）- 25名
- 觀光科（TM）- 20名

## 注意事項

1. **名額限制**：系統會即時計算各科系的已錄取人數，幫助管理員了解名額使用狀況
2. **刪除限制**：如果科系已有錄取學生，將無法刪除該科系
3. **資料一致性**：系統會自動維護資料的一致性，確保統計數據的準確性
4. **權限控制**：只有已登入的管理員才能進行科系名額管理

## 技術特點

- 使用 JSON 格式儲存學生的志願選擇
- 即時計算各科系的名額使用狀況
- 響應式設計，支援各種螢幕尺寸
- AJAX 操作，提供流暢的使用體驗
- 完整的錯誤處理和用戶提示
