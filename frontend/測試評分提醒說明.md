# 評分截止提醒郵件測試說明

## 測試腳本說明

已創建兩個腳本用於測試評分截止提醒功能：

### 1. 正式腳本：`send_score_deadline_reminders.php`
- 自動檢查明天截止的科系
- 適合設定為定時任務（cron）
- 使用方式：`php send_score_deadline_reminders.php`

### 2. 測試腳本：`test_score_deadline_reminders.php`
- 可以指定測試日期
- 輸出詳細的測試資訊
- 使用方式：
  ```bash
  # 測試明天的（預設）
  php test_score_deadline_reminders.php
  
  # 測試指定日期
  php test_score_deadline_reminders.php 2024-12-31
  ```

## 測試步驟

### 方法一：使用測試腳本（推薦）

1. **檢查資料庫中的審查時間設定**
   ```sql
   SELECT department_code, review_start, review_end 
   FROM department_quotas 
   WHERE is_active = 1 
   ORDER BY review_end;
   ```

2. **執行測試腳本**
   - 如果明天有截止的科系，直接執行：
     ```bash
     php test_score_deadline_reminders.php
     ```
   - 如果想測試特定日期，執行：
     ```bash
     php test_score_deadline_reminders.php 2024-12-31
     ```

3. **查看測試結果**
   - 腳本會輸出詳細的測試資訊
   - 包括：找到的科系、待評分的老師、發送的郵件數量等

### 方法二：手動測試郵件發送

1. **準備測試資料**
   - 確保有科系設定了 `review_end` 為明天
   - 確保有報名已分配給老師但未評分

2. **執行正式腳本**
   ```bash
   php send_score_deadline_reminders.php
   ```

3. **檢查日誌**
   - 查看 PHP 錯誤日誌
   - 查看郵件發送日誌

## 測試檢查清單

- [ ] 資料庫中有設定 `review_end` 的科系
- [ ] 有已分配但未評分的老師
- [ ] 老師的 email 欄位有值
- [ ] 郵件服務器配置正確
- [ ] 執行腳本沒有錯誤

## 預期結果

如果測試成功，應該看到：
- ✅ 找到 X 個科系的審查將於明天截止
- ✅ 找到 X 位老師有待評分項目
- ✅ 成功發送 X 封提醒郵件

## 常見問題

### 1. 沒有找到截止的科系
- 檢查 `department_quotas` 表中的 `review_end` 欄位
- 確認 `is_active = 1`
- 確認日期格式正確

### 2. 沒有待評分的老師
- 檢查 `continued_admission_assignments` 表
- 確認有分配給老師（`reviewer_type = 'teacher'`）
- 確認老師尚未評分（`continued_admission_scores` 表中沒有記錄）

### 3. 郵件發送失敗
- 檢查老師的 email 欄位是否有值
- 檢查郵件服務器配置
- 查看錯誤日誌

## 定時任務設定（正式環境）

在 Linux 系統上設定 crontab：
```bash
# 每天上午 9 點執行
0 9 * * * /usr/bin/php /path/to/Topics-backend/frontend/send_score_deadline_reminders.php >> /var/log/score_reminders.log 2>&1
```

在 Windows 系統上使用工作排程器：
1. 開啟「工作排程器」
2. 建立基本工作
3. 觸發程序：每天
4. 動作：啟動程式
5. 程式：`php.exe`
6. 引數：`C:\path\to\Topics-backend\frontend\send_score_deadline_reminders.php`


